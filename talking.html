<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Talking to Beam Interactive &mdash; Beam Interactive 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Beam Interactive 1.0.0 documentation" href="index.html" />
    <link rel="prev" title="Games" href="games.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="games.html" title="Games"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Beam Interactive 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="talking-to-beam-interactive">
<h1>Talking to Beam Interactive<a class="headerlink" href="#talking-to-beam-interactive" title="Permalink to this headline">¶</a></h1>
<div class="section" id="protocols">
<h2>Protocols<a class="headerlink" href="#protocols" title="Permalink to this headline">¶</a></h2>
<div class="section" id="robot-to-beam-interactive">
<span id="robot-to-tetris"></span><h3>Robot to Beam Interactive<a class="headerlink" href="#robot-to-beam-interactive" title="Permalink to this headline">¶</a></h3>
<p>The basic protocol is made by sending a stream of <a class="reference external" href="https://developers.google.com/protocol-buffers/?hl=en">protocol buffers</a> over a TCP socket. Each packet is preceded by its length followed by the packet ID, as variable length integers. Variable integers are described in the <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/encoding#varints">protocol buffer specification</a>.</p>
<div class="highlight-python"><div class="highlight"><pre>┌───────────────────────┐
│Packet Length (varuint)│
└───────────────────────┘
┌───────────────────────┐
│  Packet ID (varuint)  │
└───────────────────────┘
┌───────────────────────┐
│      Packet Data      │
│   (protocol buffer)   │
.........................
</pre></div>
</div>
<p>The protocol is bi-directional. Tetrid expects information sent to it to be encoded in prescribed format, and it will in turn send information in the same format.</p>
<p>See the <code class="docutils literal"><span class="pre">tetris.proto</span></code> for packets and structure. The ID mapping is as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ID</th>
<th class="head">Packet</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>Handshake</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>HandshakeACK</td>
</tr>
<tr class="row-even"><td>2</td>
<td>Report</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Error</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="frontend-to-beam-interactive">
<h3>Frontend to Beam Interactive<a class="headerlink" href="#frontend-to-beam-interactive" title="Permalink to this headline">¶</a></h3>
<p>Beam Interactive communicates over plain websockets using JSON. The basic format of a packet is a four-byte event name followed by the JSON object. Not incredibly pretty to read but easy and efficient to deal with.</p>
<dl class="object">
<dt>
<code class="descname">Handshake Packet (hshk)</code></dt>
<dd><p>The first packet sent from the client must be a handshake packet. Attributes should match those set in Redis, as described in the <span class="xref std std-ref">authentication</span> section above. Alternatively, one may send an empty <code class="docutils literal"><span class="pre">hshk{}</span></code> packet to log in anonymously. In this case they will receive <code class="docutils literal"><span class="pre">prog</span></code> updates but will not be permitted to send input and will not be counted in the quorum.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">hshk</span><span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;68b329da9893e34099c7d8ad5cb9c940&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-arg-id">
<code class="descname">id</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-id" title="Permalink to this definition">¶</a></dt>
<dd><p>The ID of the user who is authenticating.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-arg-key">
<code class="descname">key</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-key" title="Permalink to this definition">¶</a></dt>
<dd><p>Their authentication key.</p>
</dd></dl>

</dd></dl>

<dl class="object">
<dt>
<code class="descname">Handshake Acknowledgment (hack)</code></dt>
<dd><p>In response to a valid Handshake Packet, the server sends back an empty Handshake Acknowledgment.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">hack</span><span class="p">{}</span>
</pre></div>
</div>
</dd></dl>

<dl class="object">
<dt>
<code class="descname">Error (erro)</code></dt>
<dd><p>An error packet may be sent back from Beam Interactive under the following (non-comprehensive) conditions:</p>
<ul class="simple">
<li>An invalid handshake is given.</li>
<li>An unexpected or malformed packet is set.</li>
<li>A report with invalid data is sent.</li>
</ul>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">erro</span><span class="p">{</span>
    <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;Invalid channel ID or key.&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-arg-message">
<code class="descname">message</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-message" title="Permalink to this definition">¶</a></dt>
<dd><p>An error message describing what went wrong.</p>
</dd></dl>

</dd></dl>

<dl class="object">
<dt>
<code class="descname">Report (data)</code></dt>
<dd><p>Clients should report user input periodically as defined in the handshake. Events should be throttled and combined if frequent input (such as from a mouseMove in JavaScript) is given; there&#8217;s no advantage to sending input more frequently than the reporting interval.</p>
<p>If the user makes no input, you need not send a report.</p>
<p>See <a class="reference internal" href="games.html#controls"><span>the controls section</span></a> for more information on the report structure; it matches up fairly well. For reference, the Go structure which the data is loaded into is defined as:</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">Report</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Joystick</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">Axis</span>  <span class="kt">uint32</span>
        <span class="nx">Value</span> <span class="kt">float64</span>
    <span class="p">}</span>
    <span class="nx">Tactile</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">Key</span>  <span class="kt">uint32</span>
        <span class="nx">Down</span> <span class="kt">uint</span>
        <span class="nx">Up</span>   <span class="kt">uint</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">data</span><span class="p">{</span>
    <span class="nx">joystick</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">axis</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mf">0.5</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">axis</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mf">0.75</span> <span class="p">},</span>
    <span class="p">],</span>
    <span class="nx">tactile</span><span class="o">:</span> <span class="p">[</span>
        <span class="c1">// The user is dragging the LMB</span>
        <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">down</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
        <span class="c1">// The user &quot;clicked&quot; the key code 38 (up arrow) once, and</span>
        <span class="c1">// looks like is currently holding the key down.</span>
        <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">38</span><span class="p">,</span> <span class="nx">down</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">up</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="object">
<dt>
<code class="descname">Progress Event (prog)</code></dt>
<dd><p>A prog event may be sent up periodically at the behest of the Robot. It contains an array of objects for multiple controls on the frontend. For example:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">prog</span><span class="p">{</span>
    <span class="nx">updates</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">target</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">code</span><span class="o">:</span> <span class="mi">1</span>
        <span class="nx">progress</span><span class="o">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="nx">cooldown</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span>
        <span class="nx">fired</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-arg-target">
<code class="descname">target</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-target" title="Permalink to this definition">¶</a></dt>
<dd><p>The type of control this targets. <code class="docutils literal"><span class="pre">0</span></code> should be given for tactile controls, <code class="docutils literal"><span class="pre">1</span></code> for joystick controls.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-arg-code">
<code class="descname">code</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-code" title="Permalink to this definition">¶</a></dt>
<dd><p>The code for the control target. For tactile controls, this will be the <code class="docutils literal"><span class="pre">key</span></code> code. For joystick controls, this will be the <code class="docutils literal"><span class="pre">axis</span></code>.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-arg-progress">
<code class="descname">progress</code><code class="descclassname">*</code><a class="headerlink" href="#cmdoption-arg-progress" title="Permalink to this definition">¶</a></dt>
<dd><p>The progress this input as towards some threshold, designated by the robot. This must be a float value in the range [0, 1).</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-arg-cooldown">
<code class="descname">cooldown</code><code class="descclassname">*</code><a class="headerlink" href="#cmdoption-arg-cooldown" title="Permalink to this definition">¶</a></dt>
<dd><p>The duration, in milliseconds, before the action effected by this input may be carried out again. Note that this will decrement automatically on the frontend and does not need continuous updates.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-arg-fired">
<code class="descname">fired</code><code class="descclassname">*</code><a class="headerlink" href="#cmdoption-arg-fired" title="Permalink to this definition">¶</a></dt>
<dd><p>Denotes that the action effected by this control has occurred, showing a &#8220;pulse&#8221; on the input.</p>
</dd></dl>

<p>An asterisk denotes an optional property. Optional properties may not appear, or they may be sent to <code class="docutils literal"><span class="pre">null</span></code>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="the-robot">
<h2>The Robot<a class="headerlink" href="#the-robot" title="Permalink to this headline">¶</a></h2>
<p>The robot interacts with Beam Interactive using a series of packets sent back and forth. Then general authentication flow is the following:</p>
<div class="highlight-python"><div class="highlight"><pre>┌──────┐                      ┌──────┐
│      │◀──────Handshake──────│      │
│      │                      │      │
│      │─────HandshakeACK────▶│      │
│      │      (or error)      │      │
│      │                      │      │
│Server│◀───────Event─────────│Robot │
│      │◀─────────────────────│      │
│      │                      │      │
│      │────────Report───────▶│      │
│      │─────────────────────▶│      │
│      │                      │      │
└──────┘                      └──────┘
</pre></div>
</div>
<ol class="arabic simple">
<li>The Robot establishes a TCP connection to the server. It sends a Handshake packet, populated with the user ID and auth key.</li>
<li>Beam Interactive verifies the key. If it&#8217;s correct, a blank HandshakeACK packet is sent. If it&#8217;s not correct, an Error packet is sent down</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Talking to Beam Interactive</a><ul>
<li><a class="reference internal" href="#protocols">Protocols</a><ul>
<li><a class="reference internal" href="#robot-to-beam-interactive">Robot to Beam Interactive</a></li>
<li><a class="reference internal" href="#frontend-to-beam-interactive">Frontend to Beam Interactive</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-robot">The Robot</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="games.html"
                        title="previous chapter">Games</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/talking.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, WatchBeam LLC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.3</a>
      
      |
      <a href="_sources/talking.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>